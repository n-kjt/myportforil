<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/head :: head_fragment(title = 'TOP', scripts = ~{::script}, links = ~{::link})">
</head>
<body>
<div>
  <header class="header d-flex justify-content-between">
    <div>
      <h1>My Portfolio</h1>
    </div>
    <form th:action="@{/logout}" method="post">
      <input type="submit" name="logout" class="btn btn-login" value="ログアウト"/>
    </form>
  </header>
  <main>
    <div class="main-container">
      <div class="d-flex justify-content-between">
        <div class="flex-column"> 
            <img th:src="@{/img/img_none.png}" class="img_icon" alt="">
          <p class="name mt-3" sec:authentication="name"></p>
        </div>
        <div class="flex-column text-center col-6">
          <div>
            <h2 class="ttl_border">自己紹介</h2>
          </div>
          <form id="self-introduction-form">
            <div class="form-group">
              <div class="mt-5">
                <p th:text=	"${selfIntroduction}"></p>
                <a class="mt-3 btn btn-primary m-auto" th:href="@{/user/profileedit}" style="width: 240px;">自己紹介を編集する</a></div>
            </div>
          </form>
        </div>
      </div>
      <div class="mt-5 chart-form">
        <h2 class="ttl_border text-center">学習チャート</h2>
        <div class="form-group">
          <div class="mt-5">
            <div class="d-flex justify-content-center"><a type="submit" class="mt-3 btn btn-primary" href="/user/category">編集する</a></div>
          </div>
        </div>
        <div class="form-group">
			<canvas id="skillChart"></canvas>
<script th:inline="javascript">
    /*<![CDATA[*/
	var monthlyCategoryData = /*[[${monthlyCategoryData}]]*/ [];

    // カテゴリ別のデータを整理
    var months = ['今月', '先月', '来月'];
    var categories = {1: 'バックエンド', 2: 'フロントエンド', 3: 'インフラ'};
    var datasets = [];
    var categoryData = {};

    // データの初期化
    months.forEach(function(month) {
        datasets.forEach(function(dataset) {
            dataset.data.push(0);
        });
    });

    // データの準備
    monthlyCategoryData.forEach(function(item) {
        var monthIndex = months.indexOf(item.month);
        if (monthIndex !== -1) {
            if (!categoryData[item.category_id]) {
                categoryData[item.category_id] = [0, 0, 0]; // 先月、今月、来月
            }
            categoryData[item.category_id][monthIndex] = item.total_study_time;
        }
    });

    // データセットの作成
    for (var categoryId in categoryData) {
        datasets.push({
            label: categories[categoryId],
            data: categoryData[categoryId],
            backgroundColor: getRandomColor(),
            borderColor: getRandomColor(),
            borderWidth: 1
        });
    }

    // グラフの描画
    var ctx = document.getElementById('skillChart').getContext('2d');
    var skillChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: months,
            datasets: datasets
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    stacked: false
                },
                y: {
                    stacked: false
                }
            }
        }
    });

</script>
        </div>
      </div>
    </div>
  </main>
  <footer class="footer">
    <copy sec:authentication="name"></copy>
  </footer>
</div>
</body>
</html>